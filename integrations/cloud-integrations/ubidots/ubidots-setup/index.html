<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Ubidots Setup | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/ubidots/ubidots-setup/" />
  <link rel="alternate icon" href="/docs/favicon.ico">
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.87592179d2b736be842bb7a3dd97c7a09f561effecbfb81ec0a18685eb1bd4e0.css" integrity="sha256-h1khedK3Nr6EK7ej3ZfHoJ9WHv/sv7gewKGGhesb1OA=">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Ubidots Setup">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Ubidots Setup">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/ubidots/ubidots-setup/">
  <meta name="twitter:title" content="Ubidots Setup" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div id="migration-info">
      <div id="migration-text">thethingsstack.io has moved to thethingsindustries.com/docs</div>
      <div id="migration-button" class="button is-primary">Got it</div>
  </div>
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.10</p>
      </a>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav>


<main>
<section class="section">
  <div class="container">
    <div class="columns">
      
      <div class="column is-one-third">


<h2 class="title is-size-4">Ubidots</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/ubidots/" class="">Overview</a>
<li>
  <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/ubidots/ubidots-setup/" class="is-active">Ubidots Setup</a>
</li>
<li>
  <a href="https://www.thethingsindustries.com/docs/integrations/cloud-integrations/ubidots/tts-setup/" class="">The Things Stack Setup</a>
</li>
</ul>





      </div>
      
      <div class="column is-two-thirds">

<h1 class="title is-size-2">Ubidots Setup


</h1>

<div class="content">

<p>Create a function by following these instructions to prepare Ubidots setup for the integration with The Things Stack. This function will handle the conversion of incoming messages from JSON format to the one that is compatible with Ubidots.</p>
<p>Log in to your Ubidots account and find the <strong>Devices</strong> tab in the upper part of your dashboard. In its drop-down list, choose <strong>Functions</strong>.</p>
<p>When redirected to the <strong>UbiFunctions</strong> page, create a new function with the <strong>Create Function</strong> button.</p>
<p>On the left, give a <strong>Name</strong> to your function, select the <strong>POST</strong> method and choose <strong>Python 3.6</strong> for <strong>Runtime</strong>.</p>
<p>In this example, we will use the following Python function, which receives a JSON payload from The Things Stack, extracts the <code>decoded_payload</code>, and posts received data to Ubidots.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  To find your <strong>Token</strong>, click on your avatar in the upper right corner and select <strong>API Credentials</strong>. Be sure to use your <strong>Token</strong> and not your <strong>API Key</strong>.
</div>
<pre><code>import requests
import json
import time

BASE_URL = &quot;https://industrial.api.ubidots.com&quot;
TOKEN = &quot;····&quot; # Enter a token here

def main(args):
    # Prining args from TTI
    print(f'[INFO] Args from TTI:\n {args}')

    # Parsing data
    payload = parse_tti_data(args)
    dev_label = tti_dev_eui(args)
    print(f'[INFO] Parsed data:\n {payload}')
    print(f'[INFO] TTI Dev_EUI data:\n {dev_label}')

    # Posting to Ubidots
    req = update_device(dev_label, payload, TOKEN)
    print(f'[INFO] Request to Ubidots Status code: {req.status_code}')
    print(f'[INFO] Request ti Ubidots JSON:\n {req.json()}')

    return {
        'status_code': req.status_code,
        'response_json': req.json()
    }


def parse_tti_data(data):
    return data['uplink_message']['decoded_payload']


def tti_dev_eui(data):
    return data['end_device_ids']['device_id']


def update_device(device, payload, token):
    &quot;&quot;&quot;
    Updates device with payload
    &quot;&quot;&quot;
    url = &quot;{}/api/v1.6/devices/{}&quot;.format(BASE_URL, device)
    headers = {&quot;X-Auth-Token&quot;: token, &quot;Content-Type&quot;: &quot;application/json&quot;}
    req = create_request(url, headers, attempts=5, request_type=&quot;post&quot;, data=payload)
    return req


def create_request(url, headers, attempts, request_type, data=None):
    &quot;&quot;&quot;
    Function to make a request to the server
    &quot;&quot;&quot;
    request_func = getattr(requests, request_type)
    kwargs = {&quot;url&quot;: url, &quot;headers&quot;: headers}
    if request_type == &quot;post&quot; or request_type == &quot;patch&quot;:
        kwargs[&quot;json&quot;] = data
    try:
        req = request_func(**kwargs)
        status_code = req.status_code
        time.sleep(1)
        while status_code &gt;= 400 and attempts &lt; 5:
            req = request_func(**kwargs)
            status_code = req.status_code
            attempts += 1
            time.sleep(1)
        return req
    except Exception as e:
        print(&quot;[ERROR] There was an error with the request, details:&quot;)
        print(e)
        return None
</code></pre><p>After modifying the function code with your token, click the <strong>Make it live</strong> button.</p>
<p>Your function will be assigned an <strong>HTTPS Endpoint URL</strong>. Copy this URL in order to use it later as a part of setup on The Things Stack.</p>
<figure>
    <img src="creating-function.png"
         alt="Creating a UbiFunction"/> 
</figure>

<p>Your function is now ready to process the incoming messages from The Things Stack.</p>
</div>






<div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/integrations/cloud-integrations/ubidots/">← Ubidots</a>
<a class="button is-pulled-right" href="/docs/integrations/cloud-integrations/ubidots/tts-setup/">The Things Stack Setup →</a>
</div>




      </div>
    </div>
  </div>
</section>
</main>

<footer class="footer background-footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/network-and-routing/v3">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Nejra on 25 Nov 2020.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/71bd626b9b755ccbe2cbf6f6f0fc68df4cf38acd">
      doc: Update notes in Integrations
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/integrations/cloud-integrations/ubidots/ubidots-setup/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.e9df3c06e815b9686686212e86bfd0217a508f5ccee0139d7bc899ef7460191e.js" integrity="sha256-6d88BugVuWhmhiEuhr/QIXpQj1zO4BOde8iZ73RgGR4="></script>

</body>

</html>

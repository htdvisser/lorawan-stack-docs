<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Migrating from The Things Network Stack V2 | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/" />
  <link rel="alternate icon" href="/docs/favicon.ico">
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.87592179d2b736be842bb7a3dd97c7a09f561effecbfb81ec0a18685eb1bd4e0.css" integrity="sha256-h1khedK3Nr6EK7ej3ZfHoJ9WHv/sv7gewKGGhesb1OA=">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Migrating from The Things Network Stack V2">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Migrating from The Things Network Stack V2">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/">
  <meta name="twitter:title" content="Migrating from The Things Network Stack V2" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>


<body>

<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div id="migration-info">
      <div id="migration-text">thethingsstack.io has moved to thethingsindustries.com/docs</div>
      <div id="migration-button" class="button is-primary">Got it</div>
  </div>
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.10</p>
      </a>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav>


<main>
<section class="section">
  <div class="container">
    <div class="columns">
      
      <div class="column is-one-third">


<h2 class="title is-size-4">Migrating to The Things Stack</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/getting-started/migrating/" class="">Overview</a>
<li>
  <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/major-changes/" class="">Major Changes In The Things Stack</a>
</li>
<li>
  <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/gateway-migration/" class="">Migrating Gateways</a>
</li>
<li>
  <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/" class="is-active">Migrating from The Things Network Stack V2</a>
</li>
<li>
  <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrate-from-chirpstack/" class="">Migrating from ChirpStack</a>
</li>
<li>
  <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/device-json/" class="">Importable JSON File Reference</a>
</li>
<li>
  <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/import-devices/" class="">Import End Devices in The Things Stack</a>
</li>
<li>
  <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/configure-mac-settings/" class="">Fine-tuning MAC Settings for End Devices</a>
</li>
</ul>





      </div>
      
      <div class="column is-two-thirds">

<h1 class="title is-size-2">Migrating from The Things Network Stack V2


</h1>

<div class="content">

<p>This section documents the process of migrating end devices from The Things Network Stack V2 to The Things Stack.</p>
<p>For a breakdown of differences between The Things Network Stack V2 and The Things Stack, see the <a href="/docs/getting-started/migrating/major-changes/">Major Changes</a> section.</p>
<h2 id="suggested-migration-process">Suggested Migration Process</h2>
<p><strong>First</strong>: Update applications to support the The Things Stack data format. If you are using payload formatters, make sure to set them correctly from the Application settings page.</p>
<p><strong>Second</strong>: Follow this guide in order to migrate a single end device (and gateway, if needed) to The Things Stack. Continue by gradually migrating your end devices in small batches. Avoid migrating production workloads before you are certain that they will work as expected.</p>
<p><strong>Finally</strong>: Once you are confident that your end devices are working properly, migrate the rest of your devices and gateways to The Things Stack.</p>
<h2 id="configure-v2-cli">Configure V2 CLI</h2>
<p>For using <code>ttnctl</code> with <strong>The Things Network</strong>, follow <a href="https://www.thethingsnetwork.org/docs/network/cli/quick-start.html">these instructions</a>.</p>
<p>When using a <strong>private V2 network server</strong>, provided by The Things Industries, go through the following steps:</p>
<ol>
<li>
<p><a href="https://www.thethingsnetwork.org/docs/network/cli/quick-start.html">Download</a> <code>ttnctl</code> for your operating system.</p>
</li>
<li>
<p>Update <code>ttnctl</code> to the latest version by running:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl selfupdate
</code></pre></div></li>
<li>
<p>Create a file called <code>.ttnctl.yml</code> in your home directory and fill it with the following information:</p>
<pre><code>auth-server: https://account.&lt;domain_id&gt;.thethings.industries
allow-insecure: false
data: /home/&lt;user_name&gt;/.ttnctl
router-id: &lt;domain_id&gt;-router
mqtt-address: &lt;domain_id&gt;.thethings.industries:1883
handler-id: &lt;domain_id&gt;-handler
discovery-address: &lt;domain_id&gt;.thethings.industries:1900
</code></pre><p><strong>For windows users</strong> make sure to use the <code>--config</code> flag with the full path to the configuration file:</p>
<pre><code>ttnctl.exe --config fullpath/config.yml
</code></pre></li>
<li>
<p>Get the access code needed for logging in: <code>https://&lt;domain_id&gt;.thethings.industries/users/authorize?client_id=ttnctl&amp;redirect_uri=/oauth/callback/ttnctl&amp;response_type=code</code></p>
</li>
<li>
<p>Login:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl user login &lt;access_code&gt;
</code></pre></div></li>
<li>
<p>You are now logged in your private network, you should now see a folder named <code>/.ttnctl</code> in your home directory with private files.</p>
<blockquote>
<p>Optional: define an alias on ttnctl &ndash;config /home/&lt;user_name&gt;/.ttnctl/community.yml to go faster</p>
</blockquote>
</li>
</ol>
<h2 id="export-end-devices-from-v2">Export End Devices from V2</h2>
<p>In this step, the end devices from The Things Network Stack V2 will be exported in a JSON format that can then be parsed and imported by The Things Stack.</p>
<p>The exported end devices contain the device name, description, location data, activation mode (ABP/OTAA), root keys and the AppEUI. They also contain the session keys, so your OTAA devices can simply keep working with The Things Stack.</p>
<p>To get started, select the <strong>AppID</strong> and <strong>AppEUI</strong> of the application you want to export your end devices from:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl applications <span class="k">select</span>
</code></pre></div><p>After selecting the application, make sure that you can list the available end devices:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl devices list
</code></pre></div><h3 id="exporting-devices">Exporting Devices</h3>
<p>In order to export a single device, use the following command. The device will be saved to <code>device.json</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl devices <span class="nb">export</span> <span class="s2">&#34;device-id&#34;</span> --frequency-plan-id EU_863_870 &gt; device.json
</code></pre></div><p>Alternatively, you can export all the end devices with a single command and save them in <code>all-devices.json</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl devices export-all --frequency-plan-id EU_863_870 &gt; all-devices.json
</code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Change <code>EU_863_870</code> frequency plan from the command above to the frequency plan corresponding to your region. See <a href="https://www.thethingsindustries.com/docs/reference/frequency-plans/">Frequency Plans</a> for a list of supported Frequency Plans and their respective IDs.
</div>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Keep in mind that an end device can only be registered in one Network Server at a time. After importing an end device to The Things Stack, you should remove it from The Things Network Stack V2. For OTAA devices, it is enough to simply change the AppKey, so the device can no longer join but the existing session is preserved. Next time the device joins, the activation will be handled by The Things Stack.
</div>
<h3 id="disable-exported-end-devices-on-v2">Disable Exported End Devices on V2</h3>
<p>After exporting, make sure to clear the AppKey of your OTAA devices. This can be achieved with the following command:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl devices convert-to-abp <span class="s2">&#34;device-id&#34;</span> --save-to-attribute <span class="s2">&#34;original-app-key&#34;</span>
</code></pre></div><p>There is also a convenience command to clear all of your devices at once:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttnctl devices convert-all-to-abp --save-to-attribute <span class="s2">&#34;original-app-key&#34;</span>
</code></pre></div><div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  The AppKey of each device will be printed on the standard output, and stored as a device attribute (with name <code>original-app-key</code>). You can retrieve the device attributes with <code>ttnctl devices info &quot;device-id&quot;</code>.
</div>
</div>


<div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/getting-started/migrating/gateway-migration/">← Migrating Gateways</a>
<a class="button is-pulled-right" href="/docs/getting-started/migrating/migrate-from-chirpstack/">Migrating from ChirpStack →</a>
</div>


      </div>
    </div>
  </div>
</section>
</main>

<footer class="footer background-footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/network-and-routing/v3">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by benolayinka on 26 Nov 2020.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/21da11257c965cc9e733dfee24ffc3ac4f2235fd">
      doc: Change info tags to note
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/getting-started/migrating/migrating-from-v2.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.e9df3c06e815b9686686212e86bfd0217a508f5ccee0139d7bc899ef7460191e.js" integrity="sha256-6d88BugVuWhmhiEuhr/QIXpQj1zO4BOde8iZ73RgGR4="></script>

</body>

</html>
